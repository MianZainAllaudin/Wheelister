<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheelister | Car Details</title>
    <link rel="icon" href="logo-removebg-preview.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="cardetails.css">
</head>
<body>


    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="logo-removebg-preview.png" alt="Wheelister Logo">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="gotodashboard()">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="gotobookings()">My Bookings</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="gotoprofile()">Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="gotome()">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Settings</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>



    <!-- Car Details Section -->
    <section class="car-details-section">
        <div class="container">
            <div id="carDetailsContainer" class="loading-container">
                <div class="loading-spinner"></div>
            </div>
        </div>
    </section>

    <!-- Similar Cars Section -->
    <section class="similar-cars bg-light">
        <div class="container">
            <h3 class="mb-4 fw-bold">Similar Vehicles You Might Like</h3>
            <div class="row g-4" id="similarCarsContainer">
                <!-- Similar cars will be loaded here -->
            </div>
        </div>
    </section>


    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4 mb-lg-0">
                    <div class="footer-logo">
                        <img src="logo-removebg-preview.png" alt="Wheelister Logo">
                    </div>
                    <p>Your trusted partner for premium car rentals across Pakistan. Making your journeys comfortable and memorable since 2020.</p>
                    <div class="mt-4">
                        <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                
                <div class="col-lg-2 col-md-4 col-6 mb-4 mb-md-0">
                    <div class="footer-links">
                        <h5>Company</h5>
                        <ul>
                            <li><a href="about.html">About Us</a></li>
                            <li><a href="about.html">Our Team</a></li>
                            <li><a href="about.html">Careers</a></li>
                            <li><a href="about.html">Blog</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="col-lg-2 col-md-4 col-6 mb-4 mb-md-0">
                    <div class="footer-links">
                        <h5>Support</h5>
                        <ul>
                            <li><a href="about.html">Help Center</a></li>
                            <li><a href="about.html">Contact Us</a></li>
                            <li><a href="about.html">FAQs</a></li>
                            <li><a href="about.html">Feedback</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="col-lg-2 col-md-4 col-6 mb-4 mb-md-0">
                    <div class="footer-links">
                        <h5>Services</h5>
                        <ul>
                            <li><a href="UserDashboard.html">Car Rental</a></li>
                          
                        </ul>
                    </div>
                </div>
                
                <div class="col-lg-2 col-md-4 col-6">
                    <div class="footer-links">
                        <h5>Legal</h5>
                        <ul>
                            <li><a href="userSettings.html">Terms</a></li>
                            <li><a href="userSettings.html">Privacy</a></li>
                            <li><a href="userSettings.html">Cookies</a></li>
                            <li><a href="userSettings.html">Licenses</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="text-center copyright">
                &copy; 2025 Wheelister. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Navbar scroll effect (remains the same)
        window.addEventListener('scroll', function() {
            if (window.scrollY > 50) {
                document.querySelector('.navbar').classList.add('scrolled');
            } else {
                document.querySelector('.navbar').classList.remove('scrolled');
            }
        });
    
        // Navigation functions (remain the same)
        function gotodashboard() {
            setTimeout(() => window.location.href = "UserDashboard.html", 1000);
        }
    
        function gotobookings() {
            setTimeout(() => window.location.href = "bookings.html", 1000);
        }
    
        function gotoprofile() {
            setTimeout(() => window.location.href = "profile.html", 1000);
        }
    
        function gotome() {
            setTimeout(() => window.location.href = "about.html", 1000);
        }
    
        // Get car name from URL parameters
        function getCarNameFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('car_name');
        }
    
        // Load car details
      // Load car details
async function loadCarDetails() {
    const carName = getCarNameFromUrl(); // Get the car name from the URL
    const detailsContainer = document.getElementById('carDetailsContainer');

    if (!carName) {
        detailsContainer.innerHTML = '<div class="alert alert-danger">Car name not provided in the URL.</div>';
        return;
    }

    try {
        const response = await fetch('http://localhost:3000/search', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username: carName }) // Use the carName from the URL
        });

        if (!response.ok) {
            throw new Error('Failed to fetch car details');
        }

        const result = await response.json();

        if (result.success && result.data && result.data.length > 0) {
            const car = result.data[0];

            // Convert car_booking_price from string to number if needed
            const price = parseFloat(car.car_booking_price);

            detailsContainer.innerHTML = `
                <div class="row">
                    <div class="col-lg-8 fade-in">
                        <div class="car-image-slider">
                            <img src="dashboard.jpeg" alt="${car.car_name}" class="img-fluid">
                        </div>

                        <h1 class="car-title">${car.car_name}</h1>
                        <div class="car-price">Rs. ${car.car_booking_price}/day</div>

                        <div class="mb-4">
                            <span class="badge bg-primary me-2">Available</span>
                            <span class="text-muted"><i class="fas fa-map-marker-alt me-1"></i> Lahore, Pakistan</span>
                        </div>

                        <h4 class="mb-3">Car Specifications</h4>
                        <div class="row g-3 mb-4">
                            <div class="col-md-3 col-6">
                                <div class="specs-card text-center">
                                    <div class="feature-icon mx-auto">
                                        <i class="fas fa-tachometer-alt"></i>
                                    </div>
                                    <div class="specs-value">${car.car_miles} miles</div>
                                    <div class="specs-label">Mileage</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-6">
                                <div class="specs-card text-center">
                                    <div class="feature-icon mx-auto">
                                        <i class="fas fa-gas-pump"></i>
                                    </div>
                                    <div class="specs-value">Petrol</div>
                                    <div class="specs-label">Fuel Type</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-6">
                                <div class="specs-card text-center">
                                    <div class="feature-icon mx-auto">
                                        <i class="fas fa-cog"></i>
                                    </div>
                                    <div class="specs-value">Automatic</div>
                                    <div class="specs-label">Transmission</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-6">
                                <div class="specs-card text-center">
                                    <div class="feature-icon mx-auto">
                                        <i class="fas fa-user-friends"></i>
                                    </div>
                                    <div class="specs-value">5 Seats</div>
                                    <div class="specs-label">Capacity</div>
                                </div>
                            </div>
                        </div>

                        <h4 class="mb-3">Description</h4>
                        <p>Experience luxury and performance with our ${car.car_name}. This premium vehicle offers exceptional comfort, advanced safety features, and a smooth driving experience. Perfect for both city travel and long journeys.</p>

                        <h4 class="mb-3">Features</h4>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> Air Conditioning</li>
                                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> Power Steering</li>
                                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> Power Windows</li>
                                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> Anti-lock Braking System</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> Bluetooth Connectivity</li>
                                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> USB Charging Ports</li>
                                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> GPS Navigation</li>
                                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> Parking Sensors</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 fade-in" style="animation-delay: 0.3s;">
                        <div class="booking-card">
                            <h4 class="mb-4">Book This Car</h4>

                            <div class="mb-3">
                                <label for="pickupDate" class="form-label">Pickup Date</label>
                                <input type="date" class="form-control" id="pickupDate" min="${new Date().toISOString().split('T')[0]}">
                            </div>

                            <div class="mb-3">
                                <label for="returnDate" class="form-label">Return Date</label>
                                <input type="date" class="form-control" id="returnDate" min="${new Date().toISOString().split('T')[0]}">
                            </div>

                            <div class="mb-3">
                                <label for="bookingTime" class="form-label">Rental Period</label>
                                <select class="form-select" id="bookingTime">
                                    <option value="1hr">1 Hour - Rs. ${(price * 0.1).toFixed(0)}</option>
                                    <option value="2hr">2 Hours - Rs. ${(price * 0.2).toFixed(0)}</option>
                                    <option value="halfday">Half Day - Rs. ${(price * 0.5).toFixed(0)}</option>
                                    <option value="fullday" selected>Full Day - Rs. ${price}</option>
                                    <option value="week">1 Week - Rs. ${(price * 6).toFixed(0)}</option>
                                </select>
                            </div>

                            <div class="mb-4">
                                <label for="pickupLocation" class="form-label">Pickup Location</label>
                                <select class="form-select" id="pickupLocation">
                                    <option value="lahore">Lahore Warehouse</option>
                                    <option value="karachi">Karachi Warehouse</option>
                                    <option value="islamabad">Islamabad Warehouse</option>
                                </select>
                            </div>

                            <hr class="my-4">

                            <div class="d-flex justify-content-between mb-2">
                                <span>Rental Price:</span>
                                <span>Rs. ${price}</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Insurance:</span>
                                <span>Rs. ${(price * 0.15).toFixed(0)}</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span>Service Fee:</span>
                                <span>Rs. ${(price * 0.05).toFixed(0)}</span>
                            </div>

                            <div class="d-flex justify-content-between mb-4">
                                <span class="fw-bold">Total:</span>
                                <span class="fw-bold">Rs. ${(price * 1.2).toFixed(0)}</span>
                            </div>

                            <button class="booking-btn" onclick="bookCar('${car.car_name}')">
                                Book Now <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // Add event listener to update pricing when rental period changes
            addPricingEventListener();
            
            // Load similar cars
            loadSimilarCars();
        } else {
            detailsContainer.innerHTML = '<div class="alert alert-warning">Car details not found.</div>';
        }
    } catch (error) {
        console.error('Error fetching car details:', error);
        detailsContainer.innerHTML = '<div class="alert alert-danger">Failed to load car details. Please try again later.</div>';
    }
}
        // Book car function (remains the same)
  // Book car function (modified to include total_price)
async function bookCar(carName) {
    const pickupDate = document.getElementById('pickupDate').value;
    const returnDate = document.getElementById('returnDate').value;
    const rentalPeriod = document.getElementById('bookingTime').value;
    const pickupLocation = document.getElementById('pickupLocation').value;

    // Get the total price from the booking card
    const totalPriceElement = document.querySelector('.booking-card .fw-bold:last-child');
    const total_price = totalPriceElement ? totalPriceElement.textContent.replace('Rs. ', '') : null;
    const username = localStorage.getItem("username");
    if (!pickupDate || !returnDate) {
        alert('Please select pickup and return dates.');
        return;
    }

    if (!total_price) {
        alert('Could not determine the total price. Please try again.');
        return;
    }

    try {
        console.log(username);
        const response = await fetch('http://localhost:3000/book', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                car_name: carName,
                pickup_date: pickupDate,
                return_date: returnDate,
                rental_period: rentalPeriod,
                pickup_location: pickupLocation,
                total_price: total_price, // Include the total_price in the request body
                username: username
            })
        });

        if (!response.ok) {
            throw new Error('Failed to book car');
        }

        const data = await response.json();
        console.log('Booking successful:', data);
        alert(data.message); // Optionally show a success message to the user
        // You might want to redirect the user to a booking confirmation page here
    } catch (error) {
        console.error('Error booking the car:', error);
        alert('Failed to book car. Please try again later.');
    }
}

    
        // Load similar cars function (remains the same)
        function loadSimilarCars() {
            const similarCarsContainer = document.getElementById('similarCarsContainer');
    
            // Sample data for similar cars - replace with your actual API call
            const similarCars = [
                { name: 'Toyota Corolla', price: '5,000', image: 'toyota corolla.jpeg', type: 'Sedan' },
                { name: 'Honda Civic', price: '5,500', image: 'Free-download-Honda-Wallpaper.jpg', type: 'Sedan' },
                { name: 'Suzuki Cultus', price: '4,000', image: 'Suzuki Cultus 2022 wallpaper-2475.jpg', type: 'Hatchback' }
            ];
    
            similarCarsContainer.innerHTML = similarCars.map(car => `
                <div class="col-lg-4 col-md-6 fade-in">
                    <div class="similar-car-card">
                        <img src="${car.image}" class="similar-car-img" alt="${car.name}">
                        <div class="p-3">
                            <h5>${car.name}</h5>
                            <div class="d-flex justify-content-between mb-2">
                                <span class="badge bg-primary">${car.type}</span>
                                <span class="text-success fw-bold">Rs. ${car.price}/day</span>
                            </div>
                            <a href="car-details.html?car_name=${encodeURIComponent(car.name)}" class="btn btn-outline-primary btn-sm w-100">View Details</a>
                        </div>
                    </div>
                </div>
            `).join('');
        }
    
        // Document ready (remains the same)
        document.addEventListener('DOMContentLoaded', function() {
            loadCarDetails();
    
            // Intersection Observer for animations (remains the same)
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.2 });
    
            // Observe elements with animation classes (remains the same)
            setTimeout(() => {
                document.querySelectorAll('.fade-in').forEach(el => {
                    observer.observe(el);
                });
            }, 500);
        });

// Add this function after loadCarDetails() in your script

// Update pricing based on selected rental period
function updatePricing() {
    const selectedPeriod = document.getElementById('bookingTime').value;
    const basePrice = parseFloat(document.querySelector('.car-price').textContent.replace('Rs. ', '').replace('/day', ''));
    
    let rentalPrice;
    
    // Calculate rental price based on selected period
    switch(selectedPeriod) {
        case '1hr':
            rentalPrice = basePrice * 0.1;
            break;
        case '2hr':
            rentalPrice = basePrice * 0.2;
            break;
        case 'halfday':
            rentalPrice = basePrice * 0.5;
            break;
        case 'fullday':
            rentalPrice = basePrice;
            break;
        case 'week':
            rentalPrice = basePrice * 6;
            break;
        default:
            rentalPrice = basePrice;
    }
    
    // Round to whole numbers
    rentalPrice = Math.round(rentalPrice);
    const insurance = Math.round(rentalPrice * 0.15);
    const serviceFee = Math.round(rentalPrice * 0.05);
    const total = rentalPrice + insurance + serviceFee;
    
    // Update prices in the booking card
    const priceElements = document.querySelectorAll('.booking-card .d-flex span:last-child');
    priceElements[0].textContent = `Rs. ${rentalPrice}`;
    priceElements[1].textContent = `Rs. ${insurance}`;
    priceElements[2].textContent = `Rs. ${serviceFee}`;
    priceElements[3].textContent = `Rs. ${total}`;
    
    // Update dropdown options with correct prices
    updateRentalPeriodOptions(basePrice);
}

// Update the rental period dropdown options with calculated prices
function updateRentalPeriodOptions(basePrice) {
    const bookingTimeSelect = document.getElementById('bookingTime');
    const options = bookingTimeSelect.options;
    
    options[0].textContent = `1 Hour - Rs. ${Math.round(basePrice * 0.1)}`;
    options[1].textContent = `2 Hours - Rs. ${Math.round(basePrice * 0.2)}`;
    options[2].textContent = `Half Day - Rs. ${Math.round(basePrice * 0.5)}`;
    options[3].textContent = `Full Day - Rs. ${basePrice}`;
    options[4].textContent = `1 Week - Rs. ${Math.round(basePrice * 6)}`;
}

// Then update the loadCarDetails function to include an event listener for the select dropdown
// Add this inside the if(result.success) block after creating the HTML:

function addPricingEventListener() {
    const bookingTimeSelect = document.getElementById('bookingTime');
    if (bookingTimeSelect) {
        bookingTimeSelect.addEventListener('change', updatePricing);
    }
}

// Call this function at the end of your loadCarDetails function
// Also update the document ready function to call updatePricing initially:

document.addEventListener('DOMContentLoaded', function() {
    loadCarDetails();
    
    // Wait a bit for the car details to load before trying to update pricing
    setTimeout(() => {
        updatePricing();
    }, 1500);
    
    // Intersection Observer for animations (remains the same)
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('fade-in');
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.2 });
    
    // Observe elements with animation classes (remains the same)
    setTimeout(() => {
        document.querySelectorAll('.fade-in').forEach(el => {
            observer.observe(el);
        });
    }, 500);
});




    </script>
</body>
</html>